<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Help Desk - Provedor Internet{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-base-100 min-h-screen">
    <!-- Navbar -->
    {% if session.user_id %}
    <div class="navbar bg-base-200 shadow-lg">
        <div class="navbar-start">
            <div class="dropdown">
                <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
                    <i class="fas fa-bars text-xl"></i>
                </div>
                <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
                    <li><a href="{{ url_for('dashboard') }}"><i class="fas fa-home"></i> Dashboard</a></li>
                    {% if session.user_profile == 'cliente' %}
                        <li><a href="{{ url_for('novo_chamado') }}"><i class="fas fa-plus"></i> Novo Chamado</a></li>
                    {% endif %}
                    {% if session.user_profile in ['administrador', 'atendente'] %}
                        <li><a href="{{ url_for('relatorios') }}"><i class="fas fa-chart-bar"></i> Relatórios</a></li>
                        <li><a href="{{ url_for('simular_atendimento') }}"><i class="fas fa-cogs"></i> Simulação</a></li>
                    {% endif %}
                    {% if session.user_profile == 'administrador' %}
                        <li><a href="{{ url_for('gerenciar_usuarios') }}"><i class="fas fa-users"></i> Usuários</a></li>
                        <li><a href="{{ url_for('logs_auditoria_view') }}"><i class="fas fa-history"></i> Logs</a></li>
                    {% endif %}
                </ul>
            </div>
            <a href="{{ url_for('dashboard') }}" class="btn btn-ghost text-xl">
                <i class="fas fa-headset text-primary"></i>
                Help Desk
            </a>
        </div>
        
        <div class="navbar-center hidden lg:flex">
            <ul class="menu menu-horizontal px-1">
                <li><a href="{{ url_for('dashboard') }}"><i class="fas fa-home"></i> Dashboard</a></li>
                {% if session.user_profile == 'cliente' %}
                    <li><a href="{{ url_for('novo_chamado') }}"><i class="fas fa-plus"></i> Novo Chamado</a></li>
                {% endif %}
                {% if session.user_profile in ['administrador', 'atendente'] %}
                    <li><a href="{{ url_for('relatorios') }}"><i class="fas fa-chart-bar"></i> Relatórios</a></li>
                    <li><a href="{{ url_for('simular_atendimento') }}"><i class="fas fa-cogs"></i> Simulação</a></li>
                {% endif %}
                {% if session.user_profile == 'administrador' %}
                    <li>
                        <details>
                            <summary><i class="fas fa-cog"></i> Admin</summary>
                            <ul class="p-2">
                                <li><a href="{{ url_for('gerenciar_usuarios') }}"><i class="fas fa-users"></i> Usuários</a></li>
                                <li><a href="{{ url_for('logs_auditoria_view') }}"><i class="fas fa-history"></i> Logs</a></li>
                            </ul>
                        </details>
                    </li>
                {% endif %}
            </ul>
        </div>
        
        <div class="navbar-end">
            <div class="dropdown dropdown-end">
                <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                    <div class="w-10 rounded-full bg-primary text-primary-content flex items-center justify-center">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
                <ul tabindex="0" class="mt-3 z-[1] p-2 shadow menu menu-sm dropdown-content bg-base-100 rounded-box w-52">
                    <li class="menu-title">
                        <span>{{ session.user_name }}</span>
                        <span class="text-xs opacity-60">{{ session.user_profile.title() }}</span>
                    </li>
                    <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="toast toast-top toast-end z-50">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'error' if category == 'error' else 'info' }} shadow-lg">
                        <div>
                            <i class="fas fa-{{ 'check' if category == 'success' else 'exclamation-triangle' if category == 'error' else 'info-circle' }}"></i>
                            <span>{{ message }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="{% if session.user_id %}container mx-auto px-4 py-8{% else %}{% endif %}">
        {% block content %}{% endblock %}
    </main>

    <script>
        // Auto-hide toast messages
        document.addEventListener('DOMContentLoaded', function() {
            const toasts = document.querySelectorAll('.toast .alert');
            toasts.forEach(toast => {
                setTimeout(() => {
                    toast.style.transition = 'opacity 0.5s ease';
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 500);
                }, 5000);
            });
        });

        // HTMX loading indicator
        document.body.addEventListener('htmx:beforeRequest', function(evt) {
            const btn = evt.detail.elt;
            if (btn.tagName === 'BUTTON') {
                btn.classList.add('loading');
                btn.disabled = true;
            }
        });

        document.body.addEventListener('htmx:afterRequest', function(evt) {
            const btn = evt.detail.elt;
            if (btn.tagName === 'BUTTON') {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>